---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Camera Exercise" hideNavbar={true}>
    <main class="min-h-screen bg-background relative overflow-hidden">
        <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-black/70 z-50">
            <div class="loader border-4 border-t-4 border-white rounded-full w-16 h-16 animate-spin"></div>
        </div>

        <!-- Error Display -->
        <div id="errorDisplay" class="fixed inset-0 flex items-center justify-center bg-black/70 z-50 hidden">
            <div class="bg-card border border-border rounded-lg p-8 max-w-md mx-4 text-center">
                <div class="text-destructive-500 text-5xl mb-4">ðŸ“·</div>
                <h2 class="text-2xl font-bold text-foreground mb-3">Camera Error</h2>
                <p id="errorMessage" class="text-foreground/80 mb-6">
                    Unable to access the camera. Please check your camera permissions.
                </p>
                <button id="retryButton" class="bg-primary text-primary-foreground px-6 py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors">
                    Retry Camera Access
                </button>
            </div>
        </div>

        <!-- Prediction Display -->
        <div id="predictionDisplay" class="z-50 absolute bg-card border border-border rounded-lg px-6 py-4 text-foreground font-medium shadow-lg min-w-40 text-center hidden">
            <div class="text-center">
                <h3 class="text-lg font-semibold mb-2">Detections</h3>
                <div id="predictionList" class="space-y-1 text-sm"></div>
            </div>
        </div>

        <video id="cameraFeed" autoplay playsinline muted class="fixed inset-0 w-full h-full object-cover"></video>
        <canvas id="overlayCanvas" class="fixed inset-0 w-full h-full"></canvas>
    </main>

    <script type="module" is:inline src={`${process.env.GITHUB_PAGES ? import.meta.env.BASE_URL : ""}/scripts/CameraCanvasManager.js`}></script>
</Layout>

<style>
    .loader {
        border-top-color: transparent;
    }
</style>